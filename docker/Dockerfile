# syntax=docker/dockerfile:1.4

ARG BASE_IMAGE

FROM ${BASE_IMAGE}

ARG IMAGE_ENTRYPOINT
ARG BUILD_PATH
ARG JDBC_PATH
ARG JAR_LOCATION
ARG JDBC_DRIVER_LOCATION

ENV IMAGE_ENTRYPOINT_ENV=${IMAGE_ENTRYPOINT}
ENV CORDA_BASE="/opt/override"
ENV CORDA_CLI_HOME_DIR="/opt/override/home"
ENV LOG4J_CONFIG_FILE="log4j2-console.xml"
ENV ENABLE_LOG4J2_DEBUG="false"
ENV CONSOLE_LOG_LEVEL="INFO"

ADD --chown=corda:corda ${BUILD_PATH} ${JAR_LOCATION}
ADD --chown=corda:corda ${JDBC_PATH} ${JDBC_DRIVER_LOCATION} 

ENTRYPOINT ["/bin/sh","-c","${IMAGE_ENTRYPOINT_ENV} $@","$@"]
