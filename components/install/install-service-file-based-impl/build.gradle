plugins {
    id 'com.r3.internal.gradle.plugins.r3Publish'
    id 'corda.common-library'
    id 'corda.osgi-test-conventions'
}

description 'File-Based CorDapp Installer'

configurations {
    cpis {
        canBeConsumed = false
    }
}

dependencies {
    compileOnly group: "org.osgi", name: "osgi.annotation"
    compileOnly group: "org.osgi", name: "osgi.core"
    compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations"
    compileOnly group: "org.osgi", name: "org.osgi.service.cm", version: osgiCmVersion

    implementation platform(group: "net.corda", name: "corda-api", version: cordaApiVersion)
    implementation 'org.slf4j:slf4j-api'
    api project(":components:install:install-service")
    implementation "net.corda:corda-config-schema"

    implementation project(":components:configuration:configuration-read-service")

    integrationTestImplementation project(":libs:messaging:messaging")
    integrationTestImplementation project(":testing:test-utilities")
    integrationTestImplementation "net.corda:corda-avro-schema"
    integrationTestImplementation "net.corda:corda-topic-schema"

    integrationTestCompileOnly group: "org.osgi", name: "osgi.core"
    integrationTestCompileOnly group: "org.osgi", name: "org.osgi.service.component", version: osgiServiceComponentVersion
    integrationTestRuntimeOnly project(":components:configuration:configuration-read-service-impl")
    integrationTestRuntimeOnly project(":libs:lifecycle:lifecycle-impl")
    integrationTestRuntimeOnly project(":libs:messaging:inmemory-messaging-impl")
    integrationTestRuntimeOnly "org.slf4j:slf4j-simple:$slf4jVersion"

    cpis project(path: ':components:install:test-resources:workflow-cpk', configuration: 'cordaCPB')
}

tasks.named('testOSGi') {
    inputs.files configurations.cpis

    ext {
        cpiPath = provider {
            configurations.cpis.singleFile
        }
    }
}
