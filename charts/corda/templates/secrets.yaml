{{- include "corda.secret"
  ( list
    $
    .Values.bootstrap.db.cluster
    "boostrap.db.cluster"
    ( include "corda.bootstrapClusterDbDefaultSecretName" . )
    ( dict "username" ( dict ) "password" ( dict ) )
  )
}}
{{- include "corda.secret"
  ( list
    $
    .Values.db.cluster
    "db.cluster"
    ( include "corda.clusterDbDefaultSecretName" . )
    ( dict "username" ( dict "required" true ) "password" ( dict "required" true ) )
  )
}}
{{- include "corda.secret"
  ( list
    $
    .Values.config.encryption
    "config.encryption"
    ( printf "%s-config" ( include "corda.fullname" . ) )
    ( dict "salt" ( dict "generate" 32 ) "passphrase" ( dict "generate" 32 ) )
  )
}}
{{- include "corda.secret"
  ( list
    $
    .Values.bootstrap.db.crypto
    "bootstrap.db.crypto"
    ( include "corda.cryptoDbDefaultSecretName" . )
    ( dict "username" ( dict "required" true ) "password" ( dict "generate" 12 ) )
  )
}}
{{- include "corda.secret"
  ( list
    $
    .Values.bootstrap.db.rbac
    "bootstrap.db.rbac"
    ( include "corda.rbacDbDefaultSecretName" . )
    ( dict "username" ( dict "required" true ) "password" ( dict "generate" 12 ) )
  )
}}
{{- include "corda.secret"
  ( list
    $
    .Values.bootstrap.restApiAdmin
    "bootstrap.restApiAdmin"
    ( include "corda.restApiAdminSecretName" . )
    ( dict "username" ( dict "required" true ) "password" ( dict "generate" 12 ) )
  )
}}
{{- $restWorkerName := "rest-worker" }}
{{- $ca := genCA "REST Worker Self-Signed Certification Authority" 1000 }}
{{- $interCert := genSignedCert "REST Worker Intermediary Cert" nil nil 365 $ca }}
{{- $altNames := list ( printf "%s.c5.r3.com" .Release.Namespace ) ( printf "%s.%s.svc" $restWorkerName .Release.Namespace ) }}
{{- $cert := genSignedCert $restWorkerName nil $altNames 365 $interCert }}
{{- $certChain :=  printf "%s\n%s" $interCert.Cert $ca.Cert }}
{{- $secretDict := ( dict
        ( include "corda.restTlsCrtSecretKey" . ) ( dict "explicit" $cert.Cert )
        ( include "corda.restTlsKeySecretKey" . ) ( dict "explicit" $cert.Key )
        ( include "corda.restTlsCaSecretKey" . ) ( dict "explicit"  $certChain )
     )
}}
{{- include "corda.secret"
  ( list
    $
    .Values.workers.rest.tls
    "workers.rest.tls"
    ( include "corda.restTlsSecretName" . )
    $secretDict
  )
}}