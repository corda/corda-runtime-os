The Network plugin is a plugin for [Corda CLI plugin host](https://github.com/corda/corda-cli-plugin-host) to set up and manage application networks using corda-cli.

# Before you start

To use the Network plugin, you will need a working copy of `corda-cli` with the plugin installed.

## Build from source

1. Clone the [corda-cli-plugin-host](https://github.com/corda/corda-cli-plugin-host) repository from GitHub:

``` 
git clone https://github.com/corda/corda-cli-plugin-host.git
cd corda-cli-plugin-host
```

2. Build the project using Gradle:
``` 
./gradlew build
```

3. Locate the `corda-cli.sh` script in the `corda-cli-plugin-host/build/generatedScripts/` directory.

4. Build the plugin JAR from the [corda-runtime-os](https://github.com/corda/corda-runtime-os) repository from GitHub:
```
./gradlew :tools:plugins:network:build
```

5. Move the generated JAR to the `corda-cli-plugin-host/build/plugins/` directory.

6. Run commands using the `corda-cli.sh` script.

## Download from the R3 Developer Portal

1. Follow the instructions on the [Installing the Corda CLI](https://docs.r3.com/en/platform/corda/5.0/deploying-operating/tooling/installing-corda-cli.html) page.
2. Run commands using the `corda-cli.sh` script.

# Setting up an application network

## Onboard MGM

The `onboard-mgm` command creates a virtual node for an MGM and initiates the onboarding process, through which a membership group is created. The session and ECDH keys are auto-generated by the Network plugin during registration. The group policy is also exported to be used for creating Member CPI(s).

```
./corda-cli.sh network dynamic onboard-mgm "O=MGM, L=London, C=GB" -s <save-group-policy-as> --wait --user=admin --password=admin --target=https://localhost:8888 --insecure
```
Use `./corda-cli.sh network dynamic onboard-mgm --help` to view all available options.

## Onboard a member

The `onboard-member` command is for onboarding members onto a dynamic network. It creates a virtual node for the member, and starts the registration process by auto-generating session and ledger keys.

To onboard a member using a CPB and group policy:
```
./corda-cli.sh network dynamic onboard-member "O=Alice, L=London, C=GB" --cpb-file <path-to-your-CPB-file> --group-policy-file <path-to-your-group-policy> --wait --user=admin --password=admin --target=https://localhost:8888 --insecure
```

To onboard a member using the hash of a previously uploaded CPI:
```
./corda-cli.sh network dynamic onboard-member "O=Alice, L=London, C=GB" --cpi-hash <cpi-hash> --wait --user=admin --password=admin --target=https://localhost:8888 --insecure
```

To onboard a member as a notary:
```
./corda-cli.sh network dynamic onboard-member "O=Alice, L=London, C=GB" --cpi-hash <cpi-hash> --role "notary" --set "corda.notary.service.name"="C=GB, L=London, O=Notary" --wait --user=admin --password=admin --target=https://localhost:8888 --insecure
```

Use `./corda-cli.sh network dynamic onboard-member --help` to view all available options.

## Get Registrations

The `get-registrations` command is for checking the status of registration requests.

To view all requests for a holding identity:
```
./corda-cli.sh network check-registration-status -h <holding-id> --user=admin --password=admin --target=https://localhost:8888 --insecure
```

To view a specific registration request, use `--request-id`:
```
./corda-cli.sh network check-registration-status -h <holding-id> --request-id <request-id> --user=admin --password=admin --target=https://localhost:8888 --insecure
```

> Note: You can use `--name` and `--group` if the holding ID is not known. If only `--name` is specified, the last created group will be used by default.

## Lookup

The `lookup` command is for looking up group parameters or peers on the network.

> Note: You can use `--name` and `--group` if the holding ID is not known. If only `--name` is specified, the last created group will be used by default.

### Member Lookup

To lookup all members visible to a holding identity:
```
./corda-cli.sh network lookup members -h <holding-id> --user=admin --password=admin --target=https://localhost:8888 --insecure
```

Use `./corda-cli.sh network lookup members --help` to view all available options, including status and X.500 attribute filters.

### Group Parameters Lookup

To lookup group parameters for a holding identity:
```
./corda-cli.sh network lookup group-parameters -h <holding-id> --user=admin --password=admin --target=https://localhost:8888 --insecure
```
