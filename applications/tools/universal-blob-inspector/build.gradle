apply plugin: 'java'
apply plugin: 'kotlin'
apply plugin: 'corda.common-publishing'

description "Corda Universal Blob Inspector"

dependencies {
    // Use the Kotlin standard library.
    implementation 'org.jetbrains.kotlin:kotlin-stdlib'

    // AMQP support
    implementation "org.apache.qpid:proton-j:$protonjVersion"

    // Snappy (de)compression
    implementation libs.snappy.java

    // Command line parsing
    implementation "info.picocli:picocli:$picocliVersion"

    implementation libs.jackson.databind

    testImplementation libs.bundles.test
}

ext {
    cordaEnableFormatting = true
}

tasks.named('jar', Jar) {
    destinationDirectory = layout.buildDirectory.dir('bin')
    archiveBaseName = "corda-universal-blob-inspector"
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
    exclude 'META-INF/*.RSA', 'META-INF/*.SF','META-INF/*.DSA'
    manifest {
        attributes["Main-Class"] = 'net.corda.blobinspector.AppKt'
    }

    from {
        configurations.compileClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
}

tasks.register("runBlobInspectorCommand", JavaExec) {
    mainClass = "net.corda.blobinspector.AppKt"
    classpath = sourceSets.main.runtimeClasspath
    args = ["/Users/eunjee.yang/corda/corda-runtime-os/applications/tools/universal-blob-inspector/src/test/resources/net/corda/blobinspector/cash-wtx.blob"]
//    args = ["/Users/eunjee.yang/Downloads/blob2.bin"]
}

test {
    systemProperty("JARVersion", version)
}